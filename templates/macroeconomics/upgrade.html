{% extends 'base.html' %}

{% block title %}Become a Full Member{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2>Restricted Content</h2>
    <p>This content is only accessible to full members.</p>
    <button id="checkout-button" class="btn btn-primary">Click here to become a full member.</button>
</div>

<script src="https://js.stripe.com/v3/"></script>
<script type="text/javascript">
    const stripe = Stripe('{{ STRIPE_PUBLIC_KEY }}');
    const checkoutButton = document.getElementById('checkout-button');

    checkoutButton.addEventListener('click', function() {
        fetch("{% url 'checkout_session' %}", {
            method: 'POST',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}',
            },
        })
        .then(response => response.json())
        .then(session => {
            return stripe.redirectToCheckout({ sessionId: session.id });
        })
        .then(result => {
            if (result.error) {
                alert(result.error.message);
            }
        })
        .catch(error => {
            console.error('Error': error);
        });
    });
</script>
{% endblock %}